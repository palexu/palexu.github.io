---
title: JStorm æºç åˆ†æ - tuple åœ¨æ•´ä¸ªæ‹“æ‰‘ä¸­çš„æµè½¬è¿‡ç¨‹
date: 2019-01-16 23:42
---

ä»‹ç» JStorm æ—¶, å¦‚æœä¸Šæ¥å°±ç›´æ¥è´´å¤§æ®µå¤§æ®µçš„æºä»£ç , é‚£æˆ‘è§‰å¾—è¿˜ä¸å¦‚ä¸çœ‹. è¿™ç§è¡Œä¸ºå°±åƒæ˜¯è®©ç›²äººå»æ‘¸ğŸ˜, éš¾ä»¥çª¥è§æ•´ä¸ªç³»ç»Ÿçš„å…¨è²Œ.

æˆ‘ä»¬å…ˆå¼•å…¥ä¸€äº›åŸºæœ¬çš„æ¦‚å¿µ, å¯¹ JStorm æºç ä¸­ä½¿ç”¨çš„ä¸€äº›ç»„ä»¶æœ‰ä¸€ä¸ªåŸºç¡€çš„è®¤è¯†, å†åœ¨è¿™ä¸ªåŸºç¡€ä¸ŠåŠ å…¥æºç çš„åˆ†æ, è¿™æ ·æ‰èƒ½æ›´å¥½åœ°å­¦ä¹ æºç . ^_^

---

ä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªç®€å•çš„æ‹“æ‰‘ç»“æ„.

![image-20190117134048538](/Users/xj/code/palexu.github.io/_posts/assets/image-20190117134048538-7703648.png)



ä¸Šå›¾ä¸­å…±æœ‰ 3 ä¸ª task, å…¶ä¸­ 1 ä¸ª spout, 2 ä¸ª bolt, å®ƒä»¬åˆ†åˆ«è¢«åˆ†é…åœ¨ Worker 1ã€Worker 2 ä¸­. Spout ä¸ Bolt A å¤„åœ¨åŒä¸€ä¸ª Worker ä¸­,  å±äºåŒä¸€ä¸ª JVM. è€Œ Bolt B åœ¨å¦ä¸€ä¸ª Worker ä¸­, å±äºå¦ä¸€å°æœºå™¨çš„å¦ä¸€ä¸ª JVM ä¸­.

å½“æˆ‘ä»¬çš„ spout å‘é€ä¸€ä¸ª tuple å, JStorm ä¼šå°†è¿™ä¸ª tuple å‘é€ç»™ä¸‹æ¸¸çš„ task æ¶ˆè´¹( Bolt A ä¸ Bolt B ).  ä½†ä¸‹æ¸¸çš„ bolt å¤„äºä¸åŒçš„ Worker ä¸­. é‚£ä¹ˆä¸‹æ¸¸çš„ task æ˜¯å¦‚ä½•æ‹¿åˆ°è¿™ä¸ª tuple çš„, è¿™ä¸¤ç§æƒ…å†µä¸‹ JStorm æ˜¯æ€ä¹ˆå¤„ç†çš„å‘¢?

## åŸºæœ¬çš„æ•°æ®ç»“æ„

tuple åœ¨ JStorm ä¸­çš„æµåŠ¨, ä¸»è¦æ¶‰åŠåˆ°çš„æœ‰ä¸‰ä¸ªé˜Ÿåˆ—:

- deserializeQueues å¾…ååºåˆ—åŒ–é˜Ÿåˆ—
- innerTaskTransfer å¾…taskæ¶ˆè´¹é˜Ÿåˆ—
- serializeQueue å¾…åºåˆ—åŒ–é˜Ÿåˆ—

è¿™ä¸‰ä¸ªé˜Ÿåˆ—æ˜¯ JStorm ä¸­æœ€æœ€æ ¸å¿ƒçš„é˜Ÿåˆ—, æ‰€æœ‰ spuot/bolt å‘å°„çš„ tuple, ä»¥åŠæ‰€æœ‰ bolt æ¶ˆè´¹çš„ tple éƒ½ä¼šå­˜æ”¾åœ¨è¿™ä¸‰ä¸ªé˜Ÿåˆ—å½“ä¸­. ä¸‹å›¾ç”»å‡ºäº† tuple åœ¨è¿™ä¸‰ä¸ªé˜Ÿåˆ—ä¸Šçš„æµåŠ¨å…³ç³»:

![image-20190117150545298](/Users/xj/code/palexu.github.io/_posts/assets/image-20190117150545298-7708745.png)

å¦‚æœæ˜¯å‘é€åˆ°å¦ä¸€ä¸ª worker , é‚£ä¹ˆ spout å‘å°„çš„ tuple ä¼šè¢«æ”¾å…¥åˆ° serializeQueue (å¾…åºåˆ—åŒ–é˜Ÿåˆ—).  åç»­è¿™äº› tuple ä¼šè¢«åºåˆ—åŒ–åé€šè¿‡ç½‘ç»œä¼ è¾“, å‘é€åˆ°å¦ä¸€ä¸ª worker çš„ deserializeQueues (å¾…ååºåˆ—åŒ–é˜Ÿåˆ—) ä¸­.  worker åœ¨å¯åŠ¨æ—¶, ä¼šåˆ›å»ºä¸“é—¨çš„ååºåˆ—åŒ–çº¿ç¨‹. è¿™äº›åºåˆ—åŒ–è¿›ç¨‹ä¼šä¸æ–­åœ°å»æ¶ˆè´¹ deserializeQueues, å°†å…¶ä¸­çš„æ¶ˆæ¯è§£æä¸º bolt å¯ä»¥è¯†åˆ«çš„ tuple, å¹¶ä¸¢åˆ° innerTaskTransfer (å¾…taskæ¶ˆè´¹é˜Ÿåˆ—).

å¦‚æœæ˜¯å‘é€åˆ°åŒä¸€ä¸ª worker, å°±ä¸éœ€è¦ä¸Šè¿°è¿™ä¸€ç³»åˆ—æ“ä½œ, ç›´æ¥ä¸¢åˆ° innerTaskTransfer (å¾…taskæ¶ˆè´¹é˜Ÿåˆ—) å°±å®Œäº‹å„¿äº†! 

## æ›´ç»†è‡´äº›!

å¦‚æœæƒ³è¦çœ‹çš„æ›´è¯¦ç»†ä¸€ç‚¹, è¯·çœ‹ä¸‹é¢è¿™å¼ å›¾. ä¸‹å›¾ç”»å‡ºäº† tuple çš„ååºåˆ—åŒ–/åºåˆ—åŒ–/æ¶ˆè´¹/ç½‘ç»œä¼ è¾“æ‰€æ¶‰åŠçš„ç»„ä»¶: TaskReceiver, TaskTransfer, Task, NettyClient/NettyServer

- TaskReceiver: è¯¥ç»„ä»¶å†…éƒ¨æœ‰å¤šä¸ªçº¿ç¨‹, ä¼šæŒç»­æ¶ˆè´¹ deserializeQueues, å¯¹æ¶ˆæ¯è¿›è¡Œååºåˆ—åŒ–, ç„¶åæ”¾å…¥ innerTaskTransfer
- Task: è¿™ä¸ªç»„ä»¶ä¼šæŒç»­å–å‡º innerTaskTransfer ä¸­çš„ tuple, å¹¶äº¤ç»™å†…éƒ¨æŒæœ‰çš„ Spoutã€Bolt Aã€ Bolt B çš„å®ä¾‹åŒ–å¯¹è±¡å»æ¶ˆè´¹
- TaskTransfer: è¿™ä¸ªç»„ä»¶è´Ÿè´£å°† tuple åˆ†å‘ç»™ä¸åŒçš„é˜Ÿåˆ—. å®é™…ä¸Š, æ˜¯ Collector å†…éƒ¨æŒæœ‰è¿™ä¸ªå¯¹è±¡, å½“æˆ‘ä»¬è°ƒç”¨ Collector#emit, å†…éƒ¨ä¼šå»è°ƒç”¨ TaskTransfer#transfer æ¥åˆ†å‘ tuple.
- NettyClient/NettyServer: è´Ÿè´£åºåˆ—åŒ–ã€ååºåˆ—åŒ–ã€ç½‘ç»œä¼ è¾“ç­‰æ“ä½œ.

è¿™å‡ ä¸ªç»„ä»¶æ˜¯ JStorm è¿è¡Œè¿‡ç¨‹ä¸­, æ¶‰åŠåˆ° tuple å‘é€ã€æ¥å—ã€åºåˆ—åŒ–ç­‰æ“ä½œçš„æ ¸å¿ƒç»„ä»¶. å¦‚æœæƒ³è¦å¯¹ JStorm çš„å†…éƒ¨é€»è¾‘æœ‰ä¸€ä¸ªæ¸…æ™°çš„æ¦‚å¿µ, å°±å¿…é¡»äº†è§£ä¸Šé¢è¿™å‡ ä¸ªç»„ä»¶.åç»­çš„æºç åˆ†æè¿‡ç¨‹ä¸­, ä¼šå¯¹è¿™äº›ç»„ä»¶è¿›è¡Œè¯¦ç»†çš„ä»‹ç».

![](https://ws4.sinaimg.cn/large/006tNc79ly1fz9lgy4955j30za0mmdgd.jpg)

## æ€»ä½“ç»“æ„

ä¸‹å›¾æ˜¯ä¸€å¼ æ›´åŠ è¯¦ç»†çš„é«˜æ¸…å¤§å›¾äº†. è¿™å¼ å›¾ä½¿ç”¨é»‘è‰²å¸¦ç®­å¤´çš„å®çº¿, ç”»å‡ºäº† tuple çš„æµåŠ¨æ–¹å‘. å¹¶ä¸”å¼•å…¥äº† Workerã€AsyncLoopThread ç­‰æ–°çš„ç»„ä»¶

![jstorm](https://ws1.sinaimg.cn/large/006tNc79ly1fz8snni3xmj30u015itxg.jpg)

 

## æ€»ç»“

æœ¬æ–‡ä»‹ç»äº†ä»¥ä¸‹è¿™äº›é‡è¦çš„ç»„ä»¶, è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹:

- é˜Ÿåˆ— deserializeQueues/innerTaskTransfer/serializeQueue
- åºåˆ—åŒ– NettyClient
- ååºåˆ—åŒ– NettyServer
- tupleè·¯ç”± TaskTransfer
- æ‰§è¡Œä¸šåŠ¡ä»£ç  Task
- å„ä¸ªç»„ä»¶çš„å®¹å™¨ Worker

åç»­ JStorm ä¼šæ›´åŠ è¯¦ç»†åœ°å¯¹è¿™äº›ç»„ä»¶è¿›è¡Œä»‹ç»! ä¸‹æ¬¡è§^_^

